<!DOCTYPE html>
<html>

<head>
	<title>R2 Armor Generator</title>
	<style>
	body {
		font-family: Trebuchet ms, sans-serif;
		background-color: #011;
		background: linear-gradient(to top, #133, #011);
		color: #FFF;
		font-size: 16px;
		background-size: 100% 100%;
		/* Adjust the background size */
		margin-bottom: 370px;
		width: 1315px;
		margin-left: auto;
		margin-right: auto;
	}

	h1,
	h2,
	h3 {
		text-align: center;
	}

	label {
		display: block;
		margin-bottom: 3px;
	}

	input {
		width: 100px;
		margin-bottom: 0px;
	}

	.archetype-dropdown-container {
		display: flex;
		flex-direction: column;
		align-items: center;
		background-color: #233;
		padding: 5px 10px;
		border: 1px solid #000;
		border-radius: 10px;
	}

	.archetype-dropdown-title {
		text-align: center;
		margin-bottom: -10px;
	}

	.archetype-dropdown-group {
		display: flex;
		align-items: center;
	}

	.archetype-dropdown-group .archetype-select {
		text-align: center;
		width: 110px;
		font-size: 15px;
		margin-right: 10px;
		background-color: #ebefe7
	}

	#amuletDropdown {
		display: flex;
		text-align: center;
		align-items: center;
		width: 125px;
		font-size: 15px;
		background-color: #ebefe7
	}

	.ring-dropdown-container {
		display: flex;
		flex-direction: column;
		align-items: center;
		background-color: #122;
		padding: 5px 10px;
		border-radius: 10px;
	}

	.ring-dropdown-title {
		text-align: center;
		margin-bottom: -10px;
		font-size: 12px;
	}

	.ring-dropdown-group {
		display: flex;
		align-items: center;
	}

	.ring-dropdown-group .ring-select {
		text-align: center;
		width: 170px;
		font-size: 15px;
		margin-right: 10px;
		margin-top: 3px;
		background-color: #ebefe7
	}

	.unequip-button-container {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.unequip-button {
		text-align: center;
		width: 100px;
		font-size: 13px;
		margin-top: 10px;
		margin-right: 10px;
		margin-left: 0px;
	}
	/* Use Flexbox to position checkboxes next to each other */

	.checkbox-container {
		display: flex;
		align-items: center;
	}

	.checkboxes-global-container {
		display: flex;
		justify-content: right;
		margin-right: -90px;
	}

	.checkbox-container label {
		margin-right: -90px;
		/* Adjust the width as needed */
		display: inline-block;
		width: 150px;
		/* Adjust the width as needed */
	}
	/* Add a new CSS class to align the labels */

	.label-container {
		display: flex;
		background-color: #233;
		background-image: linear-gradient(#999, #999), linear-gradient(to top, #122, #233);
		background-position: top, bottom;
		background-size: 100% 0px, 100% calc(100% - 10px);
		background-repeat: no-repeat;
		padding: 5px 10px;
		border: 1px solid #000;
		border-radius: 10px;
		align-items: center;
	}
	/* Adjust the margin for label elements */

	.label-container label {
		margin-right: 10px;
		background-color: #011;
		padding: 5px 15px;
		border-radius: 6px;
		color: #d6e0d0;
	}

	#toleranceInput {
		text-align: left;
		width: 170px;
		/* Adjust the font size as needed */
		/* Adjust the width as needed */
		background-color: #ebefe7
	}

	#weightInput {
		text-align: center;
		width: 130px;
		font-size: 15px;
		/* Adjust the font size as needed */
		/* Adjust the width as needed */
		background-color: #ebefe7
	}

	.dropdown-container {
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	/* Container to hold both checkboxes and dropdown */

	.content-container {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: 0px;
		margin-left: 50px;
		margin-right: 50px;
	}

	.content-wrapper {
		display: flex;
		justify-content: center;
	}

	.gear-container {
		text-align: left;
		max-width: 300px;
	}

	.gear-container p {
		margin: 1;
		/* Reset margin for the
			<p> elements */
	}

	.gear-container p span.itemName {
		padding-right: 0px;
		/* Add spacing between label and value */
		padding-left: 2px;
		/* Add spacing between label and value */
	}

	.status-wrapper {
		align-items: center;
		letter-spacing: px;
		font-size: 18px;
		background-color: #022;
		padding: 5px 10px;
		border: 1px solid #000;
		border-radius: 10px;
	}

	.status-global-wrapper {
		display: flex;
		justify-content: space-around;
		max-width: 240px;
		margin: 0 auto;
		background-color: #011;
		padding: 5px 5px;
		border-radius: 25px;
	}

	#resultContainerWrapper {
		text-align: center;
		margin-top: 0px;
	}

	#resultContainer {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
		grid-gap: 75px;
	}

	.armor-card {
		border: 1px solid #773;
		padding: 10px;
		min-width: 250px;
		max-width: 300px;
		margin: 0 auto;
		border-radius: 5px;
		background-image: linear-gradient(#133, #011), linear-gradient(to top, #010, #022);
		background-position: top, bottom;
		background-size: 100% 36px, 100% calc(100% - 20px);
		background-repeat: no-repeat;
		margin-bottom: -70px;
	}

	.itemName {
		color: #FFFFCC;
	}

	.redColor {
		color: #FF0000;
	}

	.orangeColor {
		color: #FF8C00;
	}

	.purpleColor {
		color: #7df9ff;
	}

	.greenColor {
		color: #80ff00;
	}

	.greyColor {
		color: #d3d3d3;
	}

	.version-note {
		position: absolute;
		top: 10px;
		right: 10px;
		solid #ccc;
		border-radius: 5px;
		font-size: 10px;
		/* Ajustez la taille de la police ici */
	}

	.text-with-border {
		text-shadow: -5px -0px 0 #000, 5px -0px 0 #000, 0px 5px 0 #000, 5px -5px 0 #000;
	}
	</style>
</head>

<body>
	<div class="version-note">ver 1.3</div>
	<h1><span class="text-with-border">Remnant</span> <span style="color: red;">II</span> <span style="color: #FFFDD0	;">Armor Generator</span></h1>
	<br>
	<br>
	<div class="content-container">
		<!-- Align the elements using the new label-container class -->
		<div class="label-container">
			<label for="weightInput">Max Stamina Penalty</label>
			<select id="weightInput">
				<option value="25">Light (0%)</option>
				<option value="50">Medium (25%)</option>
				<option value="75">Heavy (50%)</option>
				<option value="999">Flop (75%)</option>
			</select>
		</div>
		<div class="label-container archetype-dropdown-container">
			<label for="archetype-dropdown-group">Archetypes (lvl 10)</label>
			<div class="archetype-dropdown-group">
				<select id="archetype1" class="archetype-select" onchange="equipArchetype('archetype1')"></select>
				<select id="archetype2" class="archetype-select" onchange="equipArchetype('archetype2')"></select>
			</div>
		</div>
		<div class="label-container amulet-container">
			<label for="amuletDropdown">Amulet</label>
			<select id="amuletDropdown">
				<option value="undefined">undefined</option>
				<option value="leto">Leto's Amulet</option>
				<option value="twistedidol">Twisted Idol</option>
			</select>
		</div>
		<div class="label-container ring-dropdown-container">
			<label for="ring-dropdown-group">Rings</label>
			<div class="ring-dropdown-group">
				<select id="ring1" class="ring-select" onchange="equipRing('ring1')"></select>
			</div>
			<div class="ring-dropdown-group">
				<select id="ring2" class="ring-select" onchange="equipRing('ring2')"></select>
			</div>
			<div class="ring-dropdown-group">
				<select id="ring3" class="ring-select" onchange="equipRing('ring3')"></select>
			</div>
			<div class="ring-dropdown-group">
				<select id="ring4" class="ring-select" onchange="equipRing('ring4')"></select>
			</div>
			<div class="unequip-button-container">
				<div></div>
				<button class="unequip-button" onclick="unequipAll()">Unequip all</button>
			</div>
		</div>
	</div>
	<br>
	<div id="resultContainerWrapper">
		<label for="toleranceInput"><span style="color: #ebefe7;">Tolerance</span></label>
		<input type="range" id="toleranceInput" value="0" min="0" max="10" step="1">
		<h2 id="totalDamageReduction"></h2>
		<div id="resultContainer"></div>
	</div>
	<script>
	async function fetchArmorData() {
		try {
			const response = await fetch('armor_list.json');
			const data = await response.json();
			return data;
		} catch(error) {
			console.error('Error fetching armor data:', error);
		}
	}
	const toleranceInput = document.getElementById("toleranceInput");
	const toleranceLabel = document.querySelector("#resultContainerWrapper label span");
	toleranceInput.addEventListener("input", function() {
		const enteredValue = parseInt(toleranceInput.value);
		toleranceLabel.textContent = `Tolerance: ${enteredValue}`;
	});
	// Set the initial label text
	toleranceLabel.textContent = `Tolerance: ${toleranceInput.value}`;
	const archetypeSelects = document.querySelectorAll('.archetype-select');
	const availableArchetypes = ['undefined', 'Challenger', 'Engineer'];
	const equippedArchetypes = {};

	function equipArchetype(selectedArchetype) {
		const selectedValue = document.getElementById(selectedArchetype).value;
		const prevEquippedArchetype = equippedArchetypes[selectedArchetype];
		if(prevEquippedArchetype) enableArchetypeOption(prevEquippedArchetype);
		if(selectedValue !== "undefined") {
			if(equippedArchetypes[selectedArchetype]) enableArchetypeOption(equippedArchetypes[selectedArchetype]);
			disableArchetypeOption(selectedValue);
			equippedArchetypes[selectedArchetype] = selectedValue;
		} else equippedArchetypes[selectedArchetype] = undefined;
	}

	function enableArchetypeOption(archetype) {
		archetypeSelects.forEach((select) => {
			const option = select.querySelector(`option[value="${archetype}"]`);
			option.disabled = false;
			option.style.display = 'block';
		});
	}

	function disableArchetypeOption(archetype) {
		archetypeSelects.forEach((select) => {
			const option = select.querySelector(`option[value="${archetype}"]`);
			option.disabled = true;
			option.style.display = 'undefined';
		});
	}
	const ringSelects = document.querySelectorAll('.ring-select');
	const availableRings = ['undefined', 'Fae Protector Signet', 'Dran Memento'];
	const equippedRings = {};

	function equipRing(selectedRing) {
		const selectedValue = document.getElementById(selectedRing).value;
		const prevEquippedRing = equippedRings[selectedRing];
		if(prevEquippedRing) enableRingOption(prevEquippedRing);
		if(selectedValue !== "undefined") {
			if(equippedRings[selectedRing]) enableRingOption(equippedRings[selectedRing]);
			disableRingOption(selectedValue);
			equippedRings[selectedRing] = selectedValue;
		} else equippedRings[selectedRing] = undefined;
	}

	function enableRingOption(ring) {
		ringSelects.forEach((select) => {
			const option = select.querySelector(`option[value="${ring}"]`);
			option.disabled = false;
			option.style.display = 'block';
		});
	}

	function disableRingOption(ring) {
		ringSelects.forEach((select) => {
			const option = select.querySelector(`option[value="${ring}"]`);
			option.disabled = true;
			option.style.display = 'undefined';
		});
	}

	function unequipAll() {
		ringSelects.forEach((select) => {
			const selectedValue = select.value;
			if(selectedValue !== "undefined") {
				enableRingOption(selectedValue);
				select.value = "undefined";
				equippedRings[select.id] = undefined;
			}
		});
		calculateAndUpdate();
	}
	window.onload = function() {
		for(const select of ringSelects) {
			availableRings.forEach((ring) => {
				const option = new Option(ring, ring);
				select.add(option);
			});
		}
		for(const select of archetypeSelects) {
			availableArchetypes.forEach((archetype) => {
				const option = new Option(archetype, archetype);
				select.add(option);
			});
		}
	};

	function find_best_combination(armor_list, weight_limit, tolerance) {
		let best_combinations = [];
		let max_damage_reduction = 0;
		// Ensure that tolerance is within the valid range of 0 to 10
		tolerance = Math.max(0, Math.min(10, tolerance));
		for(const head of armor_list['Head']) {
			for(const body of armor_list['Body']) {
				for(const legs of armor_list['Legs']) {
					for(const gloves of armor_list['Gloves']) {
						const amuletDropdown = document.getElementById("amuletDropdown");
						const selectedAmuletValue = amuletDropdown.value;
						const letoAmuletFactor = selectedAmuletValue === "leto" ? 0.6 : 1;
						const twistedidolFactor = selectedAmuletValue === "twistedidol" ? 15 : 0;
						if(equippedArchetypes.archetype1 === "Challenger" || equippedArchetypes.archetype2 === "Challenger") {
							challengerModifier = 10;
						} else {
							challengerModifier = 0;
						}
						if(equippedRings.ring1 === "Fae Protector Signet" || equippedRings.ring2 === "Fae Protector Signet" || equippedRings.ring3 === "Fae Protector Signet" || equippedRings.ring4 === "Fae Protector Signet") {
							faeprotectorsignetFactor = 5;
						} else {
							faeprotectorsignetFactor = 0;
						}
						if(equippedRings.ring1 === "Dran Memento" || equippedRings.ring2 === "Dran Memento" || equippedRings.ring3 === "Dran Memento" || equippedRings.ring4 === "Dran Memento") {
							dranmementoFactor = 5;
						} else {
							dranmementoFactor = 0;
						}
						const total_weight = ((head[8] + body[8] + legs[8] + gloves[8]) - challengerModifier - twistedidolFactor - faeprotectorsignetFactor - dranmementoFactor) * letoAmuletFactor;
						if(total_weight <= weight_limit) {
							const total_damage_reduction = head[1] + body[1] + legs[1] + gloves[1];
							if(total_damage_reduction >= max_damage_reduction - tolerance) {
								if(total_damage_reduction > max_damage_reduction) {
									max_damage_reduction = total_damage_reduction;
									best_combinations = [];
								}
								best_combinations.push({
									'Head': head,
									'Body': body,
									'Legs': legs,
									'Gloves': gloves
								});
							}
						}
					}
				}
			}
		}
		return {
			best_combinations,
			max_damage_reduction
		};
	}

	function display_combinations(best_combinations) {
		// Sort the best_combinations array based on total damage reduction and then total resistance
		best_combinations.sort((a, b) => {
			const totalDamageA = a.Head[1] + a.Body[1] + a.Legs[1] + a.Gloves[1];
			const totalDamageB = b.Head[1] + b.Body[1] + b.Legs[1] + b.Gloves[1];
			if(totalDamageA !== totalDamageB) {
				return totalDamageB - totalDamageA; // Sort by total damage reduction in descending order
			}
			// If total damage reduction is the same, sort by total resistance in descending order
			const totalResistanceA = a.Head[3] + a.Body[3] + a.Legs[3] + a.Gloves[3] + a.Head[4] + a.Body[4] + a.Legs[4] + a.Gloves[4] + a.Head[5] + a.Body[5] + a.Legs[5] + a.Gloves[5] + a.Head[6] + a.Body[6] + a.Legs[6] + a.Gloves[6] + a.Head[7] + a.Body[7] + a.Legs[7] + a.Gloves[7];
			const totalResistanceB = b.Head[3] + b.Body[3] + b.Legs[3] + b.Gloves[3] + b.Head[4] + b.Body[4] + b.Legs[4] + b.Gloves[4] + b.Head[5] + b.Body[5] + b.Legs[5] + b.Gloves[5] + b.Head[6] + b.Body[6] + b.Legs[6] + b.Gloves[6] + b.Head[7] + b.Body[7] + b.Legs[7] + b.Gloves[7];
			return totalResistanceB - totalResistanceA; // Sort by total resistance in descending order
		});
		engineerModifier = (equippedArchetypes.archetype1 === "Engineer" || equippedArchetypes.archetype2 === "Engineer") ? 1.5 : 1;
		const selectedAmuletValue = amuletDropdown.value;
		const twistedidolarmorFactor = selectedAmuletValue === "twistedidol" ? 1.3 : 1;
		const resultContainer = document.getElementById("resultContainer");
		resultContainer.innerHTML = "";
		if(best_combinations.length > 0) {
			const maxDamageReduction = best_combinations[0].Head[1] + best_combinations[0].Body[1] + best_combinations[0].Legs[1] + best_combinations[0].Gloves[1];
			const header = document.getElementById("totalDamageReduction");
			// Store the highest resistances of the previous set
			let highestResistances = {
				bleed: 0,
				fire: 0,
				shock: 0,
				toxin: 0,
				blight: 0,
				damage_reductionCheck: 0
			};
			let selectedArmors = [];
			best_combinations.forEach((combination, index) => {
				const armorSet = combination;
				const totalBleed = (armorSet.Head[3] + armorSet.Body[3] + armorSet.Legs[3] + armorSet.Gloves[3]);
				const totalFire = (armorSet.Head[4] + armorSet.Body[4] + armorSet.Legs[4] + armorSet.Gloves[4]);
				const totalShock = (armorSet.Head[5] + armorSet.Body[5] + armorSet.Legs[5] + armorSet.Gloves[5]);
				const totalBlight = (armorSet.Head[6] + armorSet.Body[6] + armorSet.Legs[6] + armorSet.Gloves[6]);
				const totalToxin = (armorSet.Head[7] + armorSet.Body[7] + armorSet.Legs[7] + armorSet.Gloves[7]);
				const totaldamage_reductionCheck = (armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]);
				let isBetter = true; // Flag to determine if the armor set is better than any previous sets
				// Compare resistances with all previously selected armor sets
				for(const selectedArmor of selectedArmors) {
					if(totalBleed === selectedArmor.bleed && totalFire === selectedArmor.fire && totalShock === selectedArmor.shock && totalToxin === selectedArmor.toxin && totalBlight === selectedArmor.blight && totaldamage_reductionCheck >= selectedArmor.damage_reductionCheck) {
						isBetter = true;
					} else if(totalBleed <= selectedArmor.bleed && totalFire <= selectedArmor.fire && totalShock <= selectedArmor.shock && totalToxin <= selectedArmor.toxin && totalBlight <= selectedArmor.blight) {
						isBetter = false;
						break
					}
				}
				if(isBetter) {
					const armorCard = document.createElement("div");
					armorCard.classList.add("armor-card");
					armorCard.innerHTML = `
						<span style="color: #ffff7f ;">Armor: ${Number.isInteger(((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * twistedidolarmorFactor) + ((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * engineerModifier) - (armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1])) ?
						(((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * twistedidolarmorFactor) + ((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * engineerModifier) - (armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1])):
						(((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * twistedidolarmorFactor) + ((armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1]) * engineerModifier) - (armorSet.Head[1] + armorSet.Body[1] + armorSet.Legs[1] + armorSet.Gloves[1])).toFixed(1)}</span>
									<div class="content-wrapper">
										<div class="gear-container">
											<p><span style="color: #d6e0d0 ;">Head:
											</span>
											<span class="itemName headColor">${armorSet.Head[0]}
											</p>
											<p><span style="color: #d6e0d0 ;">Body:
											</span>
											<span class="itemName bodyColor">${armorSet.Body[0]}
											</p>
											<p><span style="color: #d6e0d0 ;">Legs:&nbsp;
											</span>
											<span class="itemName legsColor">${armorSet.Legs[0]}
											</p>
											<p><span style="color: #d6e0d0 ;">Arms:
											</span>
											<span class="itemName glovesColor">${armorSet.Gloves[0]}
											</p>
										</div>
									</div>
									<div class="status-global-wrapper">
										<div class="status-wrapper">
											<span class="redColor">${totalBleed}</span>&nbsp
											<span class="orangeColor">${totalFire}</span>&nbsp
											<span class="purpleColor">${totalShock}</span>&nbsp
											<span class="greenColor">${totalToxin}</span>&nbsp
											<span class="greyColor">${totalBlight}</span>
										</div>
										<span style="color: #d6e0d0 ;">Total: ${armorSet.Head[2] + armorSet.Body[2] + armorSet.Legs[2] + armorSet.Gloves[2]}</span>
									</div>
								</p>`;
					resultContainer.appendChild(armorCard);
					// Update the selectedArmors array with the new armor set's resistances
					selectedArmors.push({
						bleed: totalBleed,
						fire: totalFire,
						shock: totalShock,
						toxin: totalToxin,
						blight: totalBlight,
						damage_reductionCheck: totaldamage_reductionCheck
					});
				}
			});
		} else {
			const noCombinationMessage = document.createElement("p");
			noCombinationMessage.textContent = "No valid combinations found.";
			resultContainer.appendChild(noCombinationMessage);
		}
	}
	async function calculateAndUpdate() {
		const armorData = await fetchArmorData();
		const weightLimit = parseInt(document.getElementById("weightInput").value);
		let tolerance = parseInt(document.getElementById("toleranceInput").value);
		tolerance = Math.max(0, tolerance); // Ensure tolerance is not negative
		const {
			best_combinations
		} = find_best_combination(armorData, weightLimit, tolerance);
		display_combinations(best_combinations);
	}
	// Initialize the result display when the page loads
	calculateAndUpdate();
	// Ensure to adjust the event listeners to trigger "calculateAndUpdate" function
	document.getElementById("weightInput").addEventListener("change", calculateAndUpdate);
	document.getElementById("amuletDropdown").addEventListener("change", calculateAndUpdate);
	document.getElementById("toleranceInput").addEventListener("input", calculateAndUpdate);
	document.getElementById("ring1").addEventListener("change", calculateAndUpdate);
	document.getElementById("ring2").addEventListener("change", calculateAndUpdate);
	document.getElementById("ring3").addEventListener("change", calculateAndUpdate);
	document.getElementById("ring4").addEventListener("change", calculateAndUpdate);
	document.getElementById("archetype1").addEventListener("change", calculateAndUpdate);
	document.getElementById("archetype2").addEventListener("change", calculateAndUpdate);
	// Your existing JavaScript code for initialization and calculations
	calculateAndUpdate(); // Initialize the result display when the page loads
	</script>
</body>

</html>